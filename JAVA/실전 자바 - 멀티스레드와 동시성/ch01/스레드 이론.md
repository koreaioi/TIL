# 멀티 태스킹 vs 멀티 프로세싱
말은 비슷해 보이지만, 소프트웨어와 하드웨어 관점의 차이이다.

## 멀티 태스킹
단일 CPU가 여러 작업을 동시에 수행하는 것처럼 한다.   
하드웨어는 CPU 한개 이지만, 소프트웨어를 통해(CPU 시분할) 여러 작업을 동시에 수행하는 것처럼 한다는 뜻.

## 멀티 프로세싱
프로세서(CPU)를 여러개 사용하여 작업을 수행하는 것이다.
즉, 여러 CPU(하드웨어)를 사용하여, 동시에 여러 작업을 수행하는 것이다.

## 프로세스와 스레드

### 프로세스의 메모리 구성.

![img.png](image/img.png)

- Code: 실행할 프로그램의 코드가 저장되는 부분이다.
- Data: 전역 변수 및 정적 변수가 저장되는 부분이다. 
- Heap: 동적으로 할당되는 메모리 영역이며, 가비지 컬렉터의 대상이다.
- Stack: 메서드(함수) 호출 시, 생성되는 지역 변수와 반환 주소가 저장되는 영역이며, 각 스레드당 별개의 영역이다.

### 멀티 태스킹은 무조건 좋은가?

한 프로세스에서 여러 스레드가 일을 한다면, 효율적으로 일을 하는 것만 같다.
여기서 단골 질문은 무조건 스레드가 많으면 좋냐? 라는 것이다.

문맥상 당연히 아니다.
어떤 선택에는 Trade-Off가 존재한다.
컨텍스트 스위칭에는 어떤 Trade-Off가 존재할까

### 컨텍스트 스위칭
- 1코어 기준.

컨텍스트 스위칭을 하기 위해서는 기존에 작업하던 스레드A가 어디까지 작업을 했고, 그 시점의 중간 결과와 다음에 시작한다면 어디서부터 시작을 해야하는 지 모두 기록해야한다. 나중에 해당 작업을 수행할 때, 이 값들을 불러와야한다.   
따라서 스레드가 너무 많으면, 이러한 컨텍스트 스위칭 비용으로 인해, 비효율적인 작업이 많이지게 된다.
예를들어 1부터 100,000까지 더할 때, 이런 단순한 작업은 그냥 단일 스레드로 작업하는 것이 편할것이다.
하지만 이런 일을 다음과 같이 멀티 스레드로 동작하게 한다면?

```text
- 스레드 A - 1부터 10000까지
- 스레드 B - 10001부터 20000까지
- 스레드 C - 20001부터 30000까지 
...
```

운영체제가 각 스레드의 작업을 적절히 스케줄링 할 때, 스레드 A가 1부터 2390까지 덧셈을 수행한 다음, 누적합의 결과와 다음에는 2391번부터 더해야한다는 사실을 메모리에 올린다. 그 후, 다른 스레드가 작업을 이어서 하고 반복된다.
그냥 1부터 10000까지 더하면 끝인데, 굳이 중간에 결과를 어딘가에 저장하고, 다음에는 여기부터 더하면돼 라는 불필요한 작업을 하지 않아도 된다는 말이다.

즉, 컨텍스트 스위칭은 만능이 아니다.

## CPU 바운드와 I/O 바운드

CPU 바운드 작업은 CPU를 많이 사용하는 작업이다.
- 예시: 복잡한 수학 연산, 데이터 분석, 비디오 인코딩, 과학적 시뮬레이션 등

I/O 바운드 작업은 I/O를 많이 사용하는 작업이다.
- 예시: 데이터베이스 쿼리 처리, 파일 읽기/쓰기, 네트워크 통신, 사용자 입력 처리 등.

## 웹 어플리케이션 서버
대부분의 웹 어플리케이션 서버는 대부분 I/O 바운드 작업이 많다.   
우리가 생각하는 복잡한 연산 과정은 1초에 수십억번의 계산을 하는 CPU에게는 아주 Easy하다.   
따라서, 우리가 생각하기에 복잡할거 같은 연산으로 CPU가 물리는 현상보다는, DB에 쿼리를 날리고 사용자의 입력과 네트워크를 처리하는 과정이 더 오래 걸린다는 말이다.

실제로 하나의 요청에 대해서 CPU 사용률이 얼만지 파악해보자. 
- 만약 CPU 사용률이 한 요청당 약 5%라면, 아무리 스레드를 늘려봐야 동시에 20명밖에 처리하지 못한다.
- 반대로 한 요청의 CPU 사용률이 1%이고 스레드가 10개라면, 아무리 성능 좋은 CPU를 업그레이드 해봤자 스레드를 증가시키지 않으면 동시 요청자는 10명이다.

그러므로, 많은 사용자의 요청을 받지 못하는데, 서버 장비를 단순하게 업그레이드 하기보다는, 상황에 맞게 적절한 선택을 하자.








